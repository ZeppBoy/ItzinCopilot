<div class="coin-toss-container">
  <div class="toss-card">
    <h2>Toss the Coins</h2>
    <p class="instruction">
      Click the button to toss three coins. Repeat six times to build your hexagram.
    </p>

    <div class="progress-section">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progress"></div>
      </div>
      <div class="progress-text">
        Line {{ tossResults.length }} of 6 completed
        @if (remainingTosses > 0) {
          <span class="remaining">({{ remainingTosses }} remaining)</span>
        }
      </div>
    </div>

    <div class="main-content">
      <!-- Left side: Toss button and coin animation -->
      <div class="toss-section">
        @if (tossResults.length < totalTosses) {
          <button
            class="btn-toss"
            (click)="performToss()"
            [disabled]="isTossing"
          >
            @if (isTossing) {
              <span>Tossing...</span>
            } @else {
              <span>ðŸª™ Toss Coins</span>
            }
          </button>
        } @else {
          <div class="completion-section">
            <div class="completion-message">
              <p>âœ¨ Hexagram Complete!</p>
            </div>
            <button class="btn-next" (click)="proceedToResult()">
              View Result â†’
            </button>
          </div>
        }

        @if (isTossing) {
          <div class="coins-animation">
            <img src="/assets/coins/coin-heads.svg" class="coin spinning" alt="Coin tossing">
            <img src="/assets/coins/coin-heads.svg" class="coin spinning" [style.animation-delay]="'0.1s'" alt="Coin tossing">
            <img src="/assets/coins/coin-heads.svg" class="coin spinning" [style.animation-delay]="'0.2s'" alt="Coin tossing">
          </div>
        }

        @if (showResult && currentToss) {
          <div class="toss-result">
            <div class="result-coins">
              @for (coin of currentToss.coins; track $index) {
                <img
                  [src]="coin.value === 'heads' ? '/assets/coins/coin-heads.svg' : '/assets/coins/coin-tails.svg'"
                  class="coin-result"
                  [class.heads]="coin.value === 'heads'"
                  [alt]="coin.value">
              }
            </div>
            <div class="result-line">
              <div class="line-description">{{ getLineDescription(currentToss) }}</div>
            </div>
          </div>
        }
      </div>

      <!-- Right side: Hexagram display -->
      <div class="hexagram-section">
        <h3>Building Hexagram</h3>
        <div class="hexagram-display">
          @for (result of tossResults; track $index) {
            <div class="hexagram-line" [class.changing]="result.isChanging">
              <span class="line-number">{{ $index + 1 }}</span>
              <img [src]="getLineSymbol(result)" [alt]="getLineDescription(result)" class="line-visual">
            </div>
          }
          <!-- Show empty placeholders for remaining tosses -->
          @for (i of getEmptySlots(); track i) {
            <div class="hexagram-line empty">
              <span class="line-number">{{ tossResults.length + i + 1 }}</span>
              <span class="line-visual"></span>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
